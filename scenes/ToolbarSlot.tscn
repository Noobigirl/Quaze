[gd_scene load_steps=4 format=3 uid="uid://cmg4ro7yvgr5m"]

[sub_resource type="GDScript" id="GDScript_kt1b6"]
resource_name = "toolbar_slot"
script/source = "extends Control

# -- for now
@onready var collision = $Area2D/CollisionShape2D
var slot_index: int # so that we instance the appropriate gate
var empty: bool = false
var gate_position: Vector2 # we are not setting the position at this stage
var slot_logic: String # so that we can instace all kind of gates

# the global position of the slot must be taken from its center. fix that

func set_texture(_texture):
	$SlotContainer/GateIcon.texture = load(_texture)

# toggling on or of the collision shape
func toggle_collision() -> void:
	$Area2D/CollisionShape2D.disabled = !$Area2D/CollisionShape2D.disabled

func _on_area_2d_area_entered(area: Area2D) -> void:
	 # why is this causing a bug
	#area.is_dragged = false # stopping the dragging

	if empty:
		set_texture(area.texture)
		empty = false
		slot_logic = area.logic # so that it instantiates back a gate of the same logic
		area.queue_free()
		#set_deferred(\"collision.disabled\", !collision.disabled)
		#collision.disabled = !collision.disabled
	
	# -- debuging
	print(\"area detected\")
	
func _on_button_pressed() -> void:
	if not empty: # to make sure we are emitting the signal only once
		Toolbar.current_slot = slot_index # used to retrieve the gate later
		gate_position = global_position + Vector2(48, 48)
		Toolbar.slot_pressed.emit(slot_logic)
		$SlotContainer/GateIcon.texture = null
		empty = true
		#collision.disabled = !collision.disabled #deffer it
"

[sub_resource type="StyleBoxEmpty" id="StyleBoxEmpty_kyv34"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_kt1b6"]
size = Vector2(72, 74.3226)

[node name="ToolbarSlot" type="Control" groups=["slot"]]
custom_minimum_size = Vector2(96, 96)
layout_mode = 3
anchors_preset = 0
offset_right = 96.0
offset_bottom = 96.0
grow_horizontal = 2
grow_vertical = 2
pivot_offset = Vector2(48, 48)
script = SubResource("GDScript_kt1b6")
metadata/_edit_group_ = true

[node name="SlotContainer" type="PanelContainer" parent="."]
custom_minimum_size = Vector2(96, 96)
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
pivot_offset = Vector2(48, 48)

[node name="GateIcon" type="Sprite2D" parent="SlotContainer"]
scale = Vector2(0.75, 0.75)
offset = Vector2(64, 64)

[node name="Button" type="Button" parent="."]
layout_mode = 1
anchors_preset = -1
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
pivot_offset = Vector2(48, 48)
theme_override_styles/normal = SubResource("StyleBoxEmpty_kyv34")

[node name="Area2D" type="Area2D" parent="." groups=["slot"]]
position = Vector2(23, 10)
collision_layer = 4
priority = 1

[node name="CollisionShape2D" type="CollisionShape2D" parent="Area2D"]
position = Vector2(25, 38)
scale = Vector2(1, 0.96875)
shape = SubResource("RectangleShape2D_kt1b6")

[connection signal="button_down" from="Button" to="." method="_on_button_button_down"]
[connection signal="pressed" from="Button" to="." method="_on_button_pressed"]
[connection signal="area_entered" from="Area2D" to="." method="_on_area_2d_area_entered"]
[connection signal="area_exited" from="Area2D" to="." method="_on_area_2d_area_exited"]
