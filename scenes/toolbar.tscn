[gd_scene load_steps=4 format=3 uid="uid://douxho5akulkb"]

[ext_resource type="PackedScene" uid="uid://cmg4ro7yvgr5m" path="res://scenes/ToolbarSlot.tscn" id="1_i3mxx"]
[ext_resource type="PackedScene" uid="uid://dpfhcyr6a20to" path="res://scenes/Gate.tscn" id="2_wdy5x"]

[sub_resource type="GDScript" id="GDScript_sarqt"]
resource_name = "toobar_UI"
script/source = "extends Control

@export var slot : PackedScene
@export var gate: PackedScene
var _slots

func _ready() -> void:
	Toolbar.slot_pressed.connect(add_gate) # connecting the signal to our function
	for i in Toolbar.gates.size():
		var new_slot = slot.instantiate() # creating a slot for each gate
		new_slot.set_texture(Toolbar.gates[i][1]) # setting the icon texture displayed by the slot
		new_slot.slot_index = i
		$GridContainer.add_child(new_slot) # adding the slot to the toolbar
	_slots = $GridContainer.get_children() # getting the slots when they are all added
# will be later accessed through indexes
	
func add_gate(): # executed when a slot is pressed
	# --- instancing the correct gate
	var new_gate = gate.instantiate()
	var logic = Toolbar.gates[Toolbar.current_slot][0]
	var texture = Toolbar.gates[Toolbar.current_slot][1]
	new_gate.set_gate(logic, texture)
	new_gate.global_position = _slots[Toolbar.current_slot].gate_position + Vector2(45, -100) # just to center it relative to the slot
	get_parent().add_child(new_gate) # parent must be main scene
"

[node name="Toolbar" type="Control"]
layout_mode = 3
anchor_left = 0.233
anchor_top = 0.875
anchor_right = 0.833
anchor_bottom = 0.996
offset_left = 0.23999
offset_top = 0.249969
offset_right = 0.239929
offset_bottom = 2.12
grow_horizontal = 2
grow_vertical = 0
script = SubResource("GDScript_sarqt")
slot = ExtResource("1_i3mxx")
gate = ExtResource("2_wdy5x")
metadata/_edit_group_ = true

[node name="GridContainer" type="HBoxContainer" parent="."]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
theme_override_constants/separation = 50
alignment = 1
